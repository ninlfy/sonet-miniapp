<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sonet Mini App</title>
    <!-- –°—Ç–∏–ª–∏ Telegram (–¥–ª—è –∫–Ω–æ–ø–æ–∫) -->
    <link rel="stylesheet" href="https://telegram.org/css/telegram-web-app.css">
    <!-- –ù–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="styles/index.css">
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="auth-screen">
            <h1>üîê –í—Ö–æ–¥</h1>
            <p>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ <b>Telegram Auth</b> –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ:</p>
            <input type="text" id="auth-code" placeholder="–í–∞—à –∫–æ–¥">
            <button id="submit-code" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (—Å–∫—Ä—ã—Ç–æ) -->
        <div id="main-menu" class="hidden">
            <h1>üëã –ü—Ä–∏–≤–µ—Ç, <span id="user-name">–ì–æ—Å—Ç—å</span>!</h1>
            <button id="btn-profile" class="btn">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
            <button id="btn-services" class="btn">üõ†Ô∏è –£—Å–ª—É–≥–∏</button>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Telegram WebApp API -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- –ù–∞—à —Å–∫—Ä–∏–ø—Ç -->
    <script>
const tg = window.Telegram.WebApp;
tg.expand();  // –†–∞—Å—Ç—è–≥–∏–≤–∞–µ–º Mini App –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

// –≠–ª–µ–º–µ–Ω—Ç—ã
const authScreen = document.getElementById('auth-screen');
const authCodeInput = document.getElementById('auth-code');
const submitCodeBtn = document.getElementById('submit-code');

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
submitCodeBtn.addEventListener('click', async () => {
    const code = authCodeInput.value.trim();
    
    if (!code) {
        alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥!'); // –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ tg.showAlert()
        return;
    }

    console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥:', code); // –õ–æ–≥–∏—Ä—É–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

    try {
        // –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS (—É–¥–∞–ª–∏—Ç–µ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞)
        const proxyUrl = 'https://cors-anywhere.herokuapp.com/';
        const apiUrl = `http://snit.i-cream.ru/wp-json/telegram-bot/v1/verify-code/${code}`;
        
        const response = await fetch(proxyUrl + apiUrl);
        const data = await response.json();

        console.log('–û—Ç–≤–µ—Ç API:', data); // –°–º–æ—Ç—Ä–∏–º –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞

        if (data.status === 'success') {
            alert('‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è!'); // –í—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            localStorage.setItem('tg_user', JSON.stringify(data.user));
            window.location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        } else {
            alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥!');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('‚ö†Ô∏è –û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12).');
    }
});

    </script>


</body>
</html>